class ClaudeOptimizerContent{constructor(){this.init()}init(){this.setupMessageListener()}setupMessageListener(){chrome.runtime.onMessage.addListener((e,t,n)=>("optimizeSelection"===e.action&&this.handleOptimizeSelection(e.text),!0))}async handleOptimizeSelection(e){try{await this.optimizeSelectedText(e)}catch(e){console.error("Failed to optimize selection:",e),this.showNotification("Failed to optimize text. Please try again.","error")}}async optimizeSelectedText(e){if(!e||e.trim().length<10)return void this.showNotification("Please select more text (at least 10 characters)","error");this.showNotification("ðŸ§ª Optimizing with Labratorium AI...","loading");try{const t=await chrome.storage.local.get(["apiKey","model","contextStyle"]);if(!t.apiKey)return void this.showNotification("Please configure your Claude API key in the Labratorium extension settings.","error");const n=await chrome.runtime.sendMessage({action:"optimizePrompt",data:{userPrompt:e,apiKey:t.apiKey,model:t.model||"claude-3-5-sonnet-20241022",contextStyle:t.contextStyle||"comprehensive"}});n&&n.success?this.showOptimizedResult(e,n.optimizedPrompt):this.showNotification("Optimization failed: "+(n?n.error:"Unknown error"),"error")}catch(e){console.error("Optimization error:",e),this.showNotification("Failed to optimize text. Please check your API key and try again.","error")}}showOptimizedResult(e,t){this.hideResultModal();const n=document.createElement("div");n.className="claude-optimizer-modal",n.style.cssText="position:fixed!important;top:0!important;left:0!important;width:100%!important;height:100%!important;background:rgba(0,0,0,0.5)!important;z-index:10001!important;display:flex!important;align-items:center!important;justify-content:center!important;padding:20px!important;box-sizing:border-box!important",n.innerHTML=`<div style="background:white!important;border-radius:12px!important;max-width:800px!important;width:100%!important;max-height:80vh!important;overflow:hidden!important;box-shadow:0 20px 40px rgba(0,0,0,0.3)!important"><div style="padding:20px!important;border-bottom:1px solid #d2caca!important;display:flex!important;justify-content:space-between!important;align-items:center!important"><h3 style="margin:0!important;font-family:'Courier New',monospace!important;color:#000000!important;font-size:18px!important;font-weight:700!important">ðŸ§ª Labratorium AI Optimizer</h3><button class="close-modal" style="background:none!important;border:none!important;font-size:24px!important;cursor:pointer!important;color:#6b7280!important;padding:0!important;width:30px!important;height:30px!important;display:flex!important;align-items:center!important;justify-content:center!important">Ã—</button></div><div style="padding:20px!important;overflow-y:auto!important;max-height:calc(80vh - 140px)!important"><div style="margin-bottom:20px!important"><h4 style="margin:0 0 10px 0!important;font-family:'Courier New',monospace!important;color:#6b7280!important;font-size:14px!important;font-weight:700!important">Original:</h4><div style="background:#f4f1f1!important;padding:15px!important;border-radius:0!important;font-family:'Courier New',monospace!important;font-size:14px!important;line-height:1.333!important;color:#000000!important;border:1px solid #d2caca!important">${this.escapeHtml(e)}</div></div><div style="margin-bottom:20px!important"><h4 style="margin:0 0 10px 0!important;font-family:'Courier New',monospace!important;color:#000000!important;font-size:14px!important;font-weight:700!important">Optimized:</h4><div class="optimized-content" style="background:#ffffff!important;padding:15px!important;border-radius:0!important;font-family:'Courier New',monospace!important;font-size:13px!important;line-height:1.333!important;color:#000000!important;border:2px solid #000000!important;white-space:pre-wrap!important">${this.escapeHtml(t)}</div></div></div><div style="padding:20px!important;border-top:1px solid #d2caca!important;display:flex!important;gap:10px!important;justify-content:flex-end!important"><button class="copy-optimized" style="background:#000000!important;color:#ffffff!important;border:none!important;padding:10px 20px!important;border-radius:0!important;cursor:pointer!important;font-family:'Courier New',monospace!important;font-size:14px!important;font-weight:700!important;text-transform:uppercase!important;letter-spacing:0.05em!important">Copy Optimized</button><button class="close-modal" style="background:#f4f1f1!important;color:#565151!important;border:1px solid #d2caca!important;padding:10px 20px!important;border-radius:0!important;cursor:pointer!important;font-family:'Courier New',monospace!important;font-size:14px!important;font-weight:700!important;text-transform:uppercase!important;letter-spacing:0.05em!important">Close</button></div></div>`,n.querySelector(".copy-optimized").addEventListener("click",()=>{this.copyToClipboard(t)}),n.querySelectorAll(".close-modal").forEach(e=>{e.addEventListener("click",()=>{this.hideResultModal()})}),n.addEventListener("click",e=>{e.target===n&&this.hideResultModal()});const o=e=>{"Escape"===e.key&&(this.hideResultModal(),document.removeEventListener("keydown",o))};document.addEventListener("keydown",o),document.body.appendChild(n)}hideResultModal(){const e=document.querySelector(".claude-optimizer-modal");e&&e.remove()}async copyToClipboard(e){try{await navigator.clipboard.writeText(e),this.showNotification("Copied to clipboard!","success")}catch(e){console.error("Failed to copy:",e),this.showNotification("Failed to copy to clipboard","error")}}showNotification(e,t="info"){document.querySelectorAll(".claude-optimizer-notification").forEach(e=>e.remove());const n={success:{bg:"#f0fdf4",border:"#bbf7d0",text:"#059669"},error:{bg:"#fef2f2",border:"#fecaca",text:"#dc2626"},loading:{bg:"#eff6ff",border:"#bfdbfe",text:"#2563eb"},info:{bg:"#f8fafc",border:"#e2e8f0",text:"#374151"}},o=n[t]||n.info,s=document.createElement("div");s.className="claude-optimizer-notification",s.style.cssText=`position:fixed!important;top:20px!important;right:20px!important;z-index:10002!important;background:${o.bg}!important;color:${o.text}!important;padding:15px 20px!important;border-radius:8px!important;font-family:'Courier New',monospace!important;font-size:14px!important;box-shadow:0 4px 12px rgba(0,0,0,0.1)!important;border:1px solid ${o.border}!important;max-width:300px!important;word-wrap:break-word!important`,s.textContent=e,document.body.appendChild(s),"loading"!==t&&setTimeout(()=>{s.remove()},"error"===t?5e3:3e3)}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}const claudeOptimizer=new ClaudeOptimizerContent;